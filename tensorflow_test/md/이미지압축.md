# 이미지 압축방법

## Huffman coding

허프만 부호화 또는 허프만 코딩은 파일의 문자 빈도 수를 사용하여 최소힙을 이용하여 파일을 압축하는 과정입니다.

허프만을 사용하기 전에는 직접 고정하는 길이 코드를 짜서 사용했다. 고정길이는 대표적으로 아스키코드를 사용해서 했었고 아스키코드를 
사용하여 쉽게 사용할 수 있었지만, 저장 공간 활용에 있어서 단점을 가지고 있었다.

이러한 문제를 해결하기 위해서 가변 길이 코드가 나오게 되었다.
가변길이 코드 중에서도 문자의 접두어를 사용하지 않아야 하는 그런 특징을 가진 코드가 있고, 그러지 않은 코드가 있다.

## Run-Length Encoding
Run-Length 압축은 동일한 문자가 이어서 반복되는 경우, 문자와 개수를 쌍으로 치환하는 방법이다.
Ex) AAAAABEREDFDFFFFD -> A5BEREDFDF4D


## JPEG 압축 (Joint Picture Expert Group)
JPEG은 비트맵 방식의 이미지 압축 표준 중 하나이다. 손실 압축 기법을 사용는 압축 알고리즘이며, 이미지의 손실이 심할수록 이미지의 압축률은 높아진다.
그래서 파일의 크기가 작기 때문에 PNG, GIF와 함께 웹상에서 많이 사용되는 파일형식이다.

1. 이미지 준비 (Sampling & Quantization)
- 아날로그 이미지에서 표본화와 양자화를 하여서 디지털 이미지로 변환한다. 이미지 표본화란 2차원 이미지를 x,y축을 일정한 표본으로 나누는것을 의미한다.
이미지에서 양자화는 1bit -> 흑백, 8bit -> Gray scale, 24bit -> True color 이다.
True color는 우리가 흔히 사용하는 RGB들을 의미한다. 색상을 표현할수있는 사이즈가 24bit이고 대부분은 256개의 RGB을 많이 사용한다.

2. 색 공간 변환 (YCbCr)
- RGB로 양자화된 공간을 YCbCr 색 공간으로 변환한다. 여기서 Y는 밝기의 정보이고, CbCr은 색상의 정보를 표현한다.
색공간을 YCbCr방식으로 변환하는 이유는 1차원적인 압축을 하기 위해서이다. 밝기정보에 대한 Y는 그대로 유지하고 색상정보를 줄여서 
압축을 한다. 이것을 다운샘플링(downsampling) 또는 크로마 서브샘플링(chroma subsampling)이라고 한다.

서로 인접한 픽셀들 그룹을 정한후에 픽셀들을 선정하고 대표하는 값들을 선정한다. Y성분은 다운샘플링이 되지 않으며, CbCr 성분에 대해 다운샘플링을 수행한다.

3. Block splitting
- 다운샘플링 한 후 각각의 채널을 8x8 크기의 블록으로 분할한다.
Y채널은 8x8블록으로 CbCr채널은 각각 다운샘플링 방식을 사용하여 분할한다. 이것을 Macro Block이라고 말한다.

4. DCT(Discrete Cosine Transform) - 이산 코사인 변환
- 이미지에서 인접한 픽셀과의 차이가 작은 경우 저주파를 가지고, 인접한 픽셀과의 차이가 큰 경우 고주파를 가지게 된다.
저주파 성분은 그대로 유지하고 고주파성분을 줄이는 방법으로 압축을 한다. 저주파 성분과 고주파 성분을 분리하기 위해서 이미지를 공간 영역에서 주파수 영역으로 변환해야 한다. 이것을 직교변환이라고 하는데 가장 많이 사용되는 방법이 DCT라고 할 수 있다.

8x8블럭에 DCT변환을 수행하게 되면 공간 영역에서 주파수 영역으로 변하게 되고 좌측 상단에 저주파 성분이 배치, 우측 하단에 고주파 성분이 배치하게 된다.
각 64개의 값이 DCT 변환식을 거치면서 DCT의 계수를 가지게 된다. 처음 얻는 값인 (0,0)은 다른 계수들과 달리 코사인함수가 아니고 이것을 DC계수라고 말한다.
DC 계수가 아닌 나머지 63개를 AC계수라고 한다.

5. 양자화 수행 (Quantization)
- 양자화는 고주파 성분을 제거하기 위한 방법인다. 주파수 영역에 각 계수에 대한 양자화 행렬의 상수로 나누고 반올림한다.
저주파 성분이 모여있는 좌측상단은 작은 값으로 되어있고, 고주파성분쪽이 큰 값을 가지고 있다.

압축률을 높이고 싶다면 양자화 테이블의 값을 더욱 크게 하면 되고 압축률을 줄이는 대신 이미지의 품질을 높이고 싶다면 양자화 테이블의 값을 줄이면 된다.


6. Entropy Coding
엔트로피 코딩은 무손실 압축 기법이다. AC계수의 경우 블록으로만 부호화를 한다. 그때는 zigzag scanning 기법을 사용한다.
8x8형태의 행렬을 지그제그 형태로 읽어서 일차우너 배열로 나열하는 방법이다.
이런 값들로 이제 Run-Length Encoding을 하면 된다. 그리고 마지막에 그 데이터에 허프만 부호화를 적용하면 JPEG 압축이 완성된다.
